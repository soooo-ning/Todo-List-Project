<!DOCTYPE html>
<html lang="ko">
  <%- include('include/header', { title: 'signin' })%>
  <body>
    <div class="main_wrap">
      <div class="main_img">
        <h1 class="main_title">Todo Checkk</h1>
      </div>
      <div class="main_con">
        <h3 class="sub_title">
          <span>ë¡œê·¸ì¸</span>
        </h3>
        <form name="form-login" method="post">
          <label>
            <span>EMAIL</span>
            <input
              type="email"
              placeholder="EMAILì„ ì…ë ¥í•˜ì„¸ìš”  ğŸˆí…ŒìŠ¤íŠ¸ ì´ë©”ì¼ : test@email.comğŸˆ"
              name="userEmail"
              required
            />
          </label>
          <label>
            <span>PW</span>
            <input
              type="password"
              placeholder="PWë¥¼ ì…ë ¥í•˜ì„¸ìš”  ğŸˆí…ŒìŠ¤íŠ¸ PW : 1234ğŸˆ"
              name="userPw"
              required
              minlength="4"
              maxlength="18"
            />
          </label>

          <!-- sns ë¡œê·¸ì¸ -->
          <div class="btn_wrap">
            <ul class="sns_login">
              <li class="kakao">
                <button
                  type="button"
                  onclick="window.location.href='/auth/api/sign-in/kakao'"
                >
                  <img src="../static/img/kakao_sq_s.png" alt="ì¹´ì¹´ì˜¤ë²„íŠ¼" />
                </button>
              </li>
              <li class="google">
                <button
                  type="button"
                  onclick="window.location.href='/auth/api/sign-in/google'"
                >
                  <img src="../static/img/google_sq.png" alt="êµ¬ê¸€ë²„íŠ¼" />
                </button>
              </li>
            </ul>

            <button type="submit">ë¡œê·¸ì¸</button>
          </div>
        </form>

        <div class="link">
          <a href="/auth/search-pw">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
          <a href="/auth/sign-up">íšŒì›ê°€ì…</a>
        </div>
      </div>
    </div>
    <script>
      const inputs = document.querySelectorAll('input');

      inputs.forEach((input, index) => {
        input.addEventListener('keydown', function (event) {
          if (event.key === 'Enter') {
            event.preventDefault();
            if (inputs[index + 1]) {
              inputs[index + 1].focus();
            }
          }
        });
      });

      document.forms['form-login'].addEventListener('submit', function (event) {
        event.preventDefault();

        const form = document.forms['form-login'];
        const email = document.querySelector('[name="userEmail"]').value.trim();
        const password = document.querySelector('[name="userPw"]').value.trim();

        if (!email || !password) {
          alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        if (password.length < 4 || password.length > 18) {
          alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ê¸€ìì—ì„œ 18ê¸€ì ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        const formData = {
          email: email,
          pw: password,
        };

        axios
          .post('/auth/api/sign-in', formData)
          .then((response) => {
            if (response.data.token) {
              localStorage.setItem('token', response.data.token);
              localStorage.setItem('nickname', response.data.nickname);

              alert('ë¡œê·¸ì¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
              window.location.href = '/todo/dashboard';
            }
          })
          .catch((error) => {
            console.error('ì˜¤ë¥˜:', error);
            alert('ë“±ë¡ëœ ìœ ì €ê°€ ì•„ë‹ˆê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤');
          });
      });
    </script>
  </body>
</html>
