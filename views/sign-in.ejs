<!DOCTYPE html>
<html lang="ko">
  <%- include('include/header', { title: 'signin' })%>
  <body>
    <div class="main_wrap">
      <div class="main_img">
        <h1 class="main_title">Todo Checkk</h1>
      </div>
      <div class="main_con">
        <h3 class="sub_title">
          <span>로그인</span>
        </h3>
        <form name="form-login" method="post">
          <label>
            <span>EMAIL</span>
            <input
              type="email"
              placeholder="EMAIL을 입력하세요"
              name="userEmail"
              required
            />
          </label>
          <label>
            <span>PW</span>
            <input
              type="password"
              placeholder="PW를 입력하세요"
              name="userPw"
              required
              minlength="4"
              maxlength="18"
            />
          </label>

          <!-- sns 로그인 -->
          <div class="btn_wrap">
            <ul class="sns_login">
              <li class="kakao">
                <button
                  type="button"
                  onclick="window.location.href='/auth/api/sign-in/kakao'"
                >
                  <img src="../static/img/kakao_sq_s.png" alt="카카오버튼" />
                </button>
              </li>
              <li class="google">
                <button
                  type="button"
                  onclick="window.location.href='/auth/api/sign-in/google'"
                >
                  <img src="../static/img/google_sq.png" alt="구글버튼" />
                </button>
              </li>
            </ul>

            <button type="submit">로그인</button>
          </div>
        </form>

        <div class="link">
          <a href="/auth/search-pw">비밀번호 변경</a>
          <a href="/auth/sign-up">회원가입</a>
        </div>
      </div>
    </div>
    <script>
      const inputs = document.querySelectorAll('input');

      inputs.forEach((input, index) => {
        input.addEventListener('keydown', function (event) {
          if (event.key === 'Enter') {
            event.preventDefault();
            if (inputs[index + 1]) {
              inputs[index + 1].focus();
            }
          }
        });
      });

      document.forms['form-login'].addEventListener('submit', function (event) {
        event.preventDefault();

        const form = document.forms['form-login'];
        const email = document.querySelector('[name="userEmail"]').value.trim();
        const password = document.querySelector('[name="userPw"]').value.trim();

        if (!email || !password) {
          alert('이메일과 비밀번호를 모두 입력해주세요.');
          return;
        }
        if (password.length < 4 || password.length > 18) {
          alert('비밀번호는 4글자에서 18글자 사이로 입력해주세요.');
          return;
        }

        const formData = {
          email: email,
          pw: password,
        };

        axios
          .post('/auth/api/sign-in', formData)
          .then((response) => {
            if (response.data.token) {
              localStorage.setItem('token', response.data.token);
              localStorage.setItem('nickname', response.data.nickname);

              alert('로그인 완료되었습니다.');
              window.location.href = '/todo/dashboard';
            }
          })
          .catch((error) => {
            console.error('오류:', error);
            alert('등록된 유저가 아니거나 비밀번호가 다릅니다');
          });
      });
    </script>
  </body>
</html>
